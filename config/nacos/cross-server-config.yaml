# ==================== 跨服通信配置 ====================
# 配置 Data ID: cross-server-config.yaml
# 配置 Group: GAME_SERVER
#
# 该配置用于跨服通信，包括服务发现、路由规则等

# ==================== 服务器集群配置 ====================
cluster:
  # 集群标识
  id: game-cluster-1
  # 集群名称
  name: 主集群

  # 服务器分组配置
  groups:
    - id: group-1
      name: 一区
      servers:
        - id: 1
          name: 一区1服
          # 服务地址 (Dubbo 服务自动注册，此处用于展示)
          game-service: service-game:20881
          guild-service: service-guild:20883
        - id: 2
          name: 一区2服
          game-service: service-game:20881
          guild-service: service-guild:20883

    - id: group-2
      name: 二区
      servers:
        - id: 3
          name: 二区1服
          game-service: service-game:20881
          guild-service: service-guild:20883
        - id: 4
          name: 二区2服
          game-service: service-game:20881
          guild-service: service-guild:20883

# ==================== Dubbo 跨服路由规则 ====================
dubbo:
  # 消费者配置
  consumer:
    # 默认超时
    timeout: 5000
    # 重试次数 (跨服调用建议不重试或重试1次)
    retries: 0
    # 负载均衡 (一致性哈希确保玩家/公会始终路由到同一实例)
    loadbalance: consistenthash
    # 集群容错策略
    cluster: failfast

  # 服务引用配置 (按服务定制)
  references:
    # 玩家服务
    playerService:
      interface: com.game.api.player.PlayerService
      version: 1.0.0
      group: GAME_SERVER
      timeout: 3000
      # 一致性哈希 key (按 roleId 路由)
      parameters:
        hash.arguments: "0"
        hash.nodes: "160"

    # 公会服务
    guildService:
      interface: com.game.api.guild.GuildService
      version: 1.0.0
      group: GAME_SERVER
      timeout: 5000
      # 一致性哈希 key (按 guildId 路由)
      parameters:
        hash.arguments: "0"
        hash.nodes: "160"

    # 聊天服务
    chatService:
      interface: com.game.api.chat.ChatService
      version: 1.0.0
      group: GAME_SERVER
      timeout: 3000
      # 聊天服务可以不使用一致性哈希
      loadbalance: roundrobin

    # 排行服务
    rankService:
      interface: com.game.api.rank.RankService
      version: 1.0.0
      group: GAME_SERVER
      timeout: 3000
      loadbalance: roundrobin

# ==================== 跨服功能开关 ====================
cross-server:
  # 跨服聊天
  chat:
    enabled: true
    # 跨服世界频道
    world-channel: true
    # 跨服交易频道
    trade-channel: true

  # 跨服排行
  rank:
    enabled: true
    # 参与跨服排行的榜单类型
    types:
      - combat-power
      - guild
      - arena

  # 跨服公会战
  guild-war:
    enabled: true
    # 匹配范围 (公会等级差)
    match-level-range: 3
    # 报名时间 (每周一 12:00)
    signup-time: "0 0 12 ? * MON"
    # 开战时间 (每周六 20:00)
    battle-time: "0 0 20 ? * SAT"

  # 跨服组队
  team:
    enabled: false
    # 最大队伍人数
    max-members: 4

  # 跨服副本
  dungeon:
    enabled: false
    # 支持跨服的副本 ID 列表
    dungeon-ids: []

# ==================== 服务发现标签 ====================
# 用于 Dubbo 服务筛选和路由
metadata:
  # 服务标签
  tags:
    # 服务器 ID
    server-id: ${SERVER_ID:1}
    # 服务器分组
    server-group: ${SERVER_GROUP:group-1}
    # 服务器类型 (normal/cross/all)
    server-type: normal
    # 环境标识
    env: ${ENV:dev}
