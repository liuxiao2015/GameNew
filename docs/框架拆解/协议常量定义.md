# 协议常量定义

本文档定义了游戏服务器的协议号规范和常量定义。

---

## 一、协议号规范

### 1.1 协议号结构

协议号由 **模块号 + 方法号** 组成，采用 16 位格式：

```
协议号 = (模块号 << 8) | 方法号

示例：
模块号 = 0x01 (登录模块)
方法号 = 0x02 (账号登录)
协议号 = 0x0102 = 258
```

### 1.2 模块号分配

| 模块号 | 模块名称 | 说明 |
|--------|---------|------|
| 0x00 | 系统 | 心跳、握手等 |
| 0x01 | 登录 | 账号登录、服务器列表等 |
| 0x02 | 玩家 | 玩家信息、角色操作等 |
| 0x03 | 背包 | 道具、装备等 |
| 0x04 | 公会 | 公会相关 |
| 0x05 | 聊天 | 聊天频道 |
| 0x06 | 排行 | 排行榜 |
| 0x07 | 商城 | 商城购买 |
| 0x08 | 任务 | 任务系统 |
| 0x09 | 活动 | 活动系统 |
| 0x0A | 战斗 | 战斗相关 |
| 0x0B | 社交 | 好友、邮件等 |
| 0x0C-0x0F | 预留 | 未来扩展 |
| 0xF0-0xFF | 推送 | 服务端推送 |

---

## 二、MethodId 常量定义

### 2.1 位置

```
common/common-api/src/main/java/com/game/api/common/MethodId.java
```

### 2.2 定义格式

```java
public final class MethodId {
    
    /** 系统模块 */
    public static final class System {
        /** 心跳 */
        public static final int HEARTBEAT = 0x0001;
        /** 握手 */
        public static final int HANDSHAKE = 0x0002;
    }
    
    /** 登录模块 */
    public static final class Login {
        /** 账号登录 */
        public static final int ACCOUNT_LOGIN = 0x0101;
        /** 获取服务器列表 */
        public static final int GET_SERVER_LIST = 0x0102;
        /** 选择服务器 */
        public static final int SELECT_SERVER = 0x0103;
        /** 获取角色列表 */
        public static final int GET_ROLE_LIST = 0x0104;
        /** 创建角色 */
        public static final int CREATE_ROLE = 0x0105;
        /** 进入游戏 */
        public static final int ENTER_GAME = 0x0106;
    }
    
    /** 玩家模块 */
    public static final class Player {
        /** 获取玩家信息 */
        public static final int GET_INFO = 0x0201;
        /** 更新属性 */
        public static final int UPDATE_ATTR = 0x0202;
        /** 升级 */
        public static final int LEVEL_UP = 0x0203;
    }
    
    /** 公会模块 */
    public static final class Guild {
        /** 获取公会信息 */
        public static final int GET_INFO = 0x0401;
        /** 创建公会 */
        public static final int CREATE = 0x0402;
        /** 加入公会 */
        public static final int JOIN = 0x0403;
        /** 退出公会 */
        public static final int QUIT = 0x0404;
        /** 捐献 */
        public static final int DONATE = 0x0405;
    }
    
    /** 聊天模块 */
    public static final class Chat {
        /** 发送消息 */
        public static final int SEND = 0x0501;
        /** 获取历史 */
        public static final int GET_HISTORY = 0x0502;
    }
    
    /** 排行模块 */
    public static final class Rank {
        /** 获取排行榜 */
        public static final int GET_RANK = 0x0601;
        /** 获取我的排名 */
        public static final int GET_MY_RANK = 0x0602;
    }
    
    /** 推送协议 */
    public static final class Push {
        /** 聊天消息 */
        public static final int CHAT_MESSAGE = 0xF001;
        /** 公会通知 */
        public static final int GUILD_NOTICE = 0xF002;
        /** 系统公告 */
        public static final int SYSTEM_NOTICE = 0xF003;
        /** 邮件通知 */
        public static final int MAIL_NEW = 0xF004;
        /** 属性变更 */
        public static final int ATTR_CHANGE = 0xF005;
        /** 战斗同步 */
        public static final int BATTLE_SYNC = 0xF006;
    }
}
```

---

## 三、使用示例

### 3.1 Handler 定义

```java
@ProtocolController(moduleId = 0x04, value = "公会模块")
public class GuildHandler extends BaseHandler {
    
    @Protocol(methodId = MethodId.Guild.GET_INFO, desc = "获取公会信息")
    public Message getGuildInfo(Session session, C2S_GetGuildInfo request) {
        // ...
    }
    
    @Protocol(methodId = MethodId.Guild.CREATE, desc = "创建公会")
    public Message createGuild(Session session, C2S_CreateGuild request) {
        // ...
    }
}
```

### 3.2 推送消息

```java
// 使用推送协议号
pushService.pushToPlayer(roleId, MethodId.Push.MAIL_NEW, mailMessage);

pushService.pushToGuild(guildId, MethodId.Push.GUILD_NOTICE, noticeMessage);

pushService.broadcast(MethodId.Push.SYSTEM_NOTICE, systemMessage);
```

---

## 四、Protobuf 消息命名

### 4.1 命名规范

| 类型 | 前缀 | 示例 |
|-----|------|------|
| 客户端请求 | C2S_ | C2S_Login, C2S_CreateGuild |
| 服务端响应 | S2C_ | S2C_Login, S2C_CreateGuild |
| 服务端推送 | Push_ | Push_ChatMessage, Push_SystemNotice |
| 通用消息 | 无前缀 | Result, PlayerInfo, GuildInfo |

### 4.2 文件组织

```
common/common-api/src/main/proto/game.proto  # 统一 proto 文件
```

---

## 五、错误码定义

### 5.1 位置

```
framework/framework-common/src/main/java/com/game/common/enums/ErrorCode.java
```

### 5.2 常用错误码

| 错误码 | 名称 | 说明 |
|-------|------|------|
| 0 | SUCCESS | 成功 |
| 1000 | SYSTEM_ERROR | 系统错误 |
| 1001 | PARAM_ERROR | 参数错误 |
| 1002 | DATA_NOT_FOUND | 数据不存在 |
| 1003 | NOT_LOGIN | 未登录 |
| 1004 | NO_PERMISSION | 无权限 |
| 1005 | RATE_LIMIT | 请求过于频繁 |
| 2001 | ROLE_NOT_FOUND | 角色不存在 |
| 2002 | GOLD_NOT_ENOUGH | 金币不足 |
| 2003 | DIAMOND_NOT_ENOUGH | 钻石不足 |
| 3001 | GUILD_NOT_FOUND | 公会不存在 |
| 3002 | ALREADY_IN_GUILD | 已在公会中 |

---

**文档版本**: v1.0  
**最后更新**: 2026-01
