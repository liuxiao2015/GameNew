# äº‹ä»¶æ€»çº¿ä½¿ç”¨æŒ‡å—

> **æ¨¡å—**: `framework-core`  
> **åŠŸèƒ½**: æ¨¡å—è§£è€¦ã€å¼‚æ­¥é€šä¿¡  
> **ç‰ˆæœ¬**: v1.0

---

## ğŸ“š ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [æœ¬åœ°äº‹ä»¶æ€»çº¿](#æœ¬åœ°äº‹ä»¶æ€»çº¿)
3. [åˆ†å¸ƒå¼äº‹ä»¶æ€»çº¿](#åˆ†å¸ƒå¼äº‹ä»¶æ€»çº¿)
4. [äº‹ä»¶å®šä¹‰](#äº‹ä»¶å®šä¹‰)
5. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## æ¦‚è¿°

äº‹ä»¶æ€»çº¿æä¾›å‘å¸ƒ/è®¢é˜…æœºåˆ¶ï¼Œç”¨äºæ¨¡å—é—´è§£è€¦é€šä¿¡ï¼š

| ç±»å‹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|-----|------|---------|
| `EventBus` | æœ¬åœ°äº‹ä»¶æ€»çº¿ | å•æœåŠ¡å†…éƒ¨äº‹ä»¶ |
| `DistributedEventBus` | åˆ†å¸ƒå¼äº‹ä»¶æ€»çº¿ (Redis) | è·¨æœåŠ¡äº‹ä»¶å¹¿æ’­ |
| `DubboEventBus` | Dubbo äº‹ä»¶æ€»çº¿ | å¯é çš„è·¨æœåŠ¡äº‹ä»¶ |

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æœ¬åœ°äº‹ä»¶æ€»çº¿ (EventBus)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ publish(event) â”€â”€â–º EventListener1 â”€â”€â–º EventListener2   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               åˆ†å¸ƒå¼äº‹ä»¶æ€»çº¿ (DistributedEventBus)            â”‚
â”‚                                                              â”‚
â”‚  Service A â”€â”€â–º Redis Pub/Sub â”€â”€â–º Service B                  â”‚
â”‚                     â”‚                                        â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Service C                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Dubbo äº‹ä»¶æ€»çº¿ (DubboEventBus)                  â”‚
â”‚                                                              â”‚
â”‚  Service A â”€â”€â–º Dubbo Broadcast â”€â”€â–º Service B                â”‚
â”‚                       â”‚                                      â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Service C                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æœ¬åœ°äº‹ä»¶æ€»çº¿

### 1. å®šä¹‰äº‹ä»¶

```java
package com.game.service.game.event;

import com.game.core.event.GameEvent;
import lombok.Getter;

/**
 * ç©å®¶ç›¸å…³äº‹ä»¶
 */
public class PlayerEvents {

    /**
     * ç©å®¶å‡çº§äº‹ä»¶
     */
    @Getter
    public static class PlayerLevelUpEvent extends GameEvent {
        private final long roleId;
        private final int oldLevel;
        private final int newLevel;

        public PlayerLevelUpEvent(long roleId, int oldLevel, int newLevel) {
            super("PLAYER_LEVEL_UP");
            this.roleId = roleId;
            this.oldLevel = oldLevel;
            this.newLevel = newLevel;
        }
    }

    /**
     * ç©å®¶ç™»å½•äº‹ä»¶
     */
    @Getter
    public static class PlayerLoginEvent extends GameEvent {
        private final long roleId;
        private final String ip;
        private final long loginTime;

        public PlayerLoginEvent(long roleId, String ip) {
            super("PLAYER_LOGIN");
            this.roleId = roleId;
            this.ip = ip;
            this.loginTime = System.currentTimeMillis();
        }
    }

    /**
     * ç©å®¶ä¸‹çº¿äº‹ä»¶
     */
    @Getter
    public static class PlayerOfflineEvent extends GameEvent {
        private final long roleId;

        public PlayerOfflineEvent(long roleId) {
            super("PLAYER_OFFLINE");
            this.roleId = roleId;
        }
    }

    /**
     * ç©å®¶è·å¾—ç‰©å“äº‹ä»¶
     */
    @Getter
    public static class PlayerGetItemEvent extends GameEvent {
        private final long roleId;
        private final int itemId;
        private final int count;
        private final String source;

        public PlayerGetItemEvent(long roleId, int itemId, int count, String source) {
            super("PLAYER_GET_ITEM");
            this.roleId = roleId;
            this.itemId = itemId;
            this.count = count;
            this.source = source;
        }
    }
}
```

### 2. å‘å¸ƒäº‹ä»¶

```java
package com.game.service.game.service;

import com.game.core.event.EventBus;
import com.game.service.game.event.PlayerEvents;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;

@Slf4j
@Service
@RequiredArgsConstructor
public class PlayerService {

    private final EventBus eventBus;

    /**
     * ç©å®¶å‡çº§
     */
    public void levelUp(long roleId, int oldLevel, int newLevel) {
        // ä¸šåŠ¡é€»è¾‘...
        
        // å‘å¸ƒäº‹ä»¶ (åŒæ­¥)
        eventBus.publish(new PlayerEvents.PlayerLevelUpEvent(roleId, oldLevel, newLevel));
    }

    /**
     * ç©å®¶ç™»å½•
     */
    public void onLogin(long roleId, String ip) {
        // ä¸šåŠ¡é€»è¾‘...
        
        // å‘å¸ƒäº‹ä»¶ (å¼‚æ­¥)
        eventBus.publishAsync(new PlayerEvents.PlayerLoginEvent(roleId, ip));
    }

    /**
     * è·å¾—ç‰©å“
     */
    public void addItem(long roleId, int itemId, int count, String source) {
        // ä¸šåŠ¡é€»è¾‘...
        
        // å‘å¸ƒäº‹ä»¶
        eventBus.publish(new PlayerEvents.PlayerGetItemEvent(roleId, itemId, count, source));
    }
}
```

### 3. ç›‘å¬äº‹ä»¶ (æ³¨è§£æ–¹å¼)

```java
package com.game.service.game.listener;

import com.game.core.event.EventListener;
import com.game.core.push.DubboPushService;
import com.game.service.game.event.PlayerEvents;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;

/**
 * æ¸¸æˆäº‹ä»¶ç›‘å¬å™¨
 */
@Slf4j
@Component
@RequiredArgsConstructor
public class GameEventListener {

    private final DubboPushService pushService;
    private final RewardService rewardService;
    private final QuestService questService;

    /**
     * ç›‘å¬ç©å®¶å‡çº§äº‹ä»¶
     */
    @EventListener
    public void onPlayerLevelUp(PlayerEvents.PlayerLevelUpEvent event) {
        log.info("ç©å®¶å‡çº§: roleId={}, {} -> {}", 
                event.getRoleId(), event.getOldLevel(), event.getNewLevel());
        
        // å‘æ”¾å‡çº§å¥–åŠ±
        rewardService.grantLevelUpReward(event.getRoleId(), event.getNewLevel());
        
        // æ¨é€å‡çº§é€šçŸ¥
        pushService.pushToPlayer(event.getRoleId(), MethodId.PUSH_LEVEL_UP,
                S2C_LevelUp.newBuilder()
                        .setLevel(event.getNewLevel())
                        .build());
    }

    /**
     * ç›‘å¬ç©å®¶å‡çº§äº‹ä»¶ (å¼‚æ­¥å¤„ç†)
     */
    @EventListener(async = true)
    public void onPlayerLevelUpAsync(PlayerEvents.PlayerLevelUpEvent event) {
        // å¼‚æ­¥å¤„ç†ï¼šæ›´æ–°ä»»åŠ¡è¿›åº¦
        questService.onPlayerLevelUp(event.getRoleId(), event.getNewLevel());
    }

    /**
     * ç›‘å¬ç©å®¶å‡çº§äº‹ä»¶ (é«˜ä¼˜å…ˆçº§)
     */
    @EventListener(priority = 100)
    public void onPlayerLevelUpHighPriority(PlayerEvents.PlayerLevelUpEvent event) {
        // é«˜ä¼˜å…ˆçº§ï¼šå…ˆæ‰§è¡Œ
        log.debug("é«˜ä¼˜å…ˆçº§å¤„ç†: ç©å®¶ {} å‡çº§", event.getRoleId());
    }

    /**
     * ç›‘å¬ç©å®¶ç™»å½•äº‹ä»¶
     */
    @EventListener
    public void onPlayerLogin(PlayerEvents.PlayerLoginEvent event) {
        log.info("ç©å®¶ç™»å½•: roleId={}, ip={}", event.getRoleId(), event.getIp());
        
        // å‘é€ç™»å½•å¥–åŠ±
        rewardService.checkLoginReward(event.getRoleId());
    }

    /**
     * ç›‘å¬ç©å®¶ä¸‹çº¿äº‹ä»¶
     */
    @EventListener
    public void onPlayerOffline(PlayerEvents.PlayerOfflineEvent event) {
        log.info("ç©å®¶ä¸‹çº¿: roleId={}", event.getRoleId());
        
        // æ¸…ç†ç©å®¶ç›¸å…³æ•°æ®
        cleanupPlayerData(event.getRoleId());
    }

    /**
     * ç›‘å¬ç©å®¶è·å¾—ç‰©å“äº‹ä»¶
     */
    @EventListener
    public void onPlayerGetItem(PlayerEvents.PlayerGetItemEvent event) {
        log.debug("ç©å®¶è·å¾—ç‰©å“: roleId={}, itemId={}, count={}, source={}", 
                event.getRoleId(), event.getItemId(), event.getCount(), event.getSource());
        
        // æ›´æ–°ä»»åŠ¡è¿›åº¦
        questService.onGetItem(event.getRoleId(), event.getItemId(), event.getCount());
        
        // è®°å½•æ—¥å¿—
        logItemGain(event);
    }

    private void cleanupPlayerData(long roleId) {
        // æ¸…ç†é€»è¾‘
    }

    private void logItemGain(PlayerEvents.PlayerGetItemEvent event) {
        // æ—¥å¿—è®°å½•
    }
}
```

### 4. ç›‘å¬äº‹ä»¶ (ç¼–ç¨‹æ–¹å¼)

```java
@PostConstruct
public void init() {
    // æ‰‹åŠ¨æ³¨å†Œç›‘å¬å™¨
    eventBus.register(PlayerEvents.PlayerLevelUpEvent.class, event -> {
        log.info("ç©å®¶å‡çº§: {}", event.getRoleId());
    });

    // å¸¦ä¼˜å…ˆçº§å’Œå¼‚æ­¥æ ‡å¿—
    eventBus.register(
            PlayerEvents.PlayerLoginEvent.class,
            event -> processLogin(event),
            10,    // ä¼˜å…ˆçº§
            true   // å¼‚æ­¥
    );
}
```

### 5. @EventListener å‚æ•°è¯´æ˜

```java
@EventListener(
    // ä¼˜å…ˆçº§ (æ•°å€¼è¶Šå¤§è¶Šå…ˆæ‰§è¡Œï¼Œé»˜è®¤ 0)
    priority = 100,
    
    // æ˜¯å¦å¼‚æ­¥æ‰§è¡Œ (é»˜è®¤ false)
    async = true
)
public void onEvent(SomeEvent event) {
    // å¤„ç†äº‹ä»¶
}
```

---

## åˆ†å¸ƒå¼äº‹ä»¶æ€»çº¿

### 1. åŸºäº Redis çš„åˆ†å¸ƒå¼äº‹ä»¶

```java
package com.game.service.game.service;

import com.game.core.event.DistributedEventBus;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;

@Slf4j
@Service
@RequiredArgsConstructor
public class GlobalEventService {

    private final DistributedEventBus distributedEventBus;

    /**
     * å‘å¸ƒå…¨å±€äº‹ä»¶ (å¹¿æ’­åˆ°æ‰€æœ‰æœåŠ¡)
     */
    public void publishGlobalEvent(String eventType, Object data) {
        distributedEventBus.publishGlobal(eventType, data);
    }

    /**
     * å‘å¸ƒé…ç½®é‡è½½äº‹ä»¶
     */
    public void publishConfigReload(String configName) {
        distributedEventBus.publishGlobal("config:reload", configName);
    }

    /**
     * å‘å¸ƒç¼“å­˜å¤±æ•ˆäº‹ä»¶
     */
    public void publishCacheEvict(String cacheKey) {
        distributedEventBus.publishGlobal("cache:evict", cacheKey);
    }

    /**
     * å‘å¸ƒå…¬å‘Š
     */
    public void publishAnnouncement(String content) {
        distributedEventBus.publishGlobal("announcement", content);
    }
}
```

### 2. ç›‘å¬åˆ†å¸ƒå¼äº‹ä»¶

```java
package com.game.service.game.listener;

import com.game.core.event.DistributedEventBus;
import jakarta.annotation.PostConstruct;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;

@Slf4j
@Component
@RequiredArgsConstructor
public class DistributedEventListener {

    private final DistributedEventBus distributedEventBus;
    private final ConfigLoader configLoader;
    private final CacheService cacheService;

    @PostConstruct
    public void init() {
        // è®¢é˜…é…ç½®é‡è½½äº‹ä»¶
        distributedEventBus.subscribe("config:reload", this::onConfigReload);
        
        // è®¢é˜…ç¼“å­˜å¤±æ•ˆäº‹ä»¶
        distributedEventBus.subscribe("cache:evict", this::onCacheEvict);
        
        // è®¢é˜…å…¬å‘Šäº‹ä»¶
        distributedEventBus.subscribe("announcement", this::onAnnouncement);
        
        // è®¢é˜…æ¯æ—¥é‡ç½®äº‹ä»¶
        distributedEventBus.subscribe("daily:reset", this::onDailyReset);
    }

    private void onConfigReload(String message) {
        log.info("æ”¶åˆ°é…ç½®é‡è½½äº‹ä»¶: {}", message);
        configLoader.reload(message);
    }

    private void onCacheEvict(String message) {
        log.info("æ”¶åˆ°ç¼“å­˜å¤±æ•ˆäº‹ä»¶: {}", message);
        cacheService.evict(message);
    }

    private void onAnnouncement(String message) {
        log.info("æ”¶åˆ°å…¬å‘Šäº‹ä»¶: {}", message);
        // å¹¿æ’­å…¬å‘Šç»™æ‰€æœ‰åœ¨çº¿ç©å®¶
        broadcastAnnouncement(message);
    }

    private void onDailyReset(String message) {
        log.info("æ”¶åˆ°æ¯æ—¥é‡ç½®äº‹ä»¶: {}", message);
        // æ‰§è¡Œæœ¬åœ°æ¯æ—¥é‡ç½®é€»è¾‘
        doDailyReset();
    }

    private void broadcastAnnouncement(String content) {
        // å¹¿æ’­å®ç°
    }

    private void doDailyReset() {
        // é‡ç½®å®ç°
    }
}
```

### 3. åŸºäº Dubbo çš„åˆ†å¸ƒå¼äº‹ä»¶

```java
package com.game.core.event;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.apache.dubbo.config.annotation.DubboReference;
import org.springframework.stereotype.Service;

/**
 * Dubbo äº‹ä»¶æ€»çº¿
 * <p>
 * æ¯” Redis Pub/Sub æ›´å¯é ï¼Œåˆ©ç”¨ Dubbo å¹¿æ’­æœºåˆ¶
 * </p>
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class DubboEventBus {

    @DubboReference(
        cluster = "broadcast",  // å¹¿æ’­æ¨¡å¼
        timeout = 3000,
        check = false
    )
    private DistributedEventService eventService;

    private final EventBus localEventBus;

    /**
     * å‘å¸ƒäº‹ä»¶åˆ°æ‰€æœ‰æœåŠ¡
     */
    public void publishToAll(GameEvent event) {
        try {
            eventService.publish(event.getEventType(), event);
        } catch (Exception e) {
            log.error("å‘å¸ƒåˆ†å¸ƒå¼äº‹ä»¶å¤±è´¥: {}", event.getEventType(), e);
        }
    }

    /**
     * æ¥æ”¶äº‹ä»¶ (ç”± DistributedEventServiceImpl è°ƒç”¨)
     */
    public void onReceive(String eventType, GameEvent event) {
        log.debug("æ”¶åˆ°åˆ†å¸ƒå¼äº‹ä»¶: {}", eventType);
        // è½¬å‘åˆ°æœ¬åœ°äº‹ä»¶æ€»çº¿
        localEventBus.publish(event);
    }
}
```

---

## äº‹ä»¶å®šä¹‰

### 1. åŸºç¡€äº‹ä»¶ç±»

```java
package com.game.core.event;

import lombok.Getter;

/**
 * æ¸¸æˆäº‹ä»¶åŸºç±»
 */
@Getter
public abstract class GameEvent {
    
    /**
     * äº‹ä»¶ç±»å‹
     */
    private final String eventType;
    
    /**
     * äº‹ä»¶åˆ›å»ºæ—¶é—´
     */
    private final long timestamp;
    
    /**
     * æ˜¯å¦å·²å–æ¶ˆ
     */
    private volatile boolean cancelled = false;

    protected GameEvent(String eventType) {
        this.eventType = eventType;
        this.timestamp = System.currentTimeMillis();
    }

    /**
     * å–æ¶ˆäº‹ä»¶ (åç»­ç›‘å¬å™¨å°†ä¸ä¼šæ”¶åˆ°æ­¤äº‹ä»¶)
     */
    public void cancel() {
        this.cancelled = true;
    }
}
```

### 2. å¯å–æ¶ˆçš„äº‹ä»¶

```java
/**
 * èŠå¤©äº‹ä»¶ (å¯è¢«å–æ¶ˆï¼Œç”¨äºæ•æ„Ÿè¯è¿‡æ»¤)
 */
@Getter
public class ChatEvent extends GameEvent {
    private final long roleId;
    private final String channel;
    private String content;  // å¯ä¿®æ”¹

    public ChatEvent(long roleId, String channel, String content) {
        super("CHAT");
        this.roleId = roleId;
        this.channel = channel;
        this.content = content;
    }

    public void setContent(String content) {
        this.content = content;
    }
}

// ä½¿ç”¨
@EventListener(priority = 100)  // å…ˆæ‰§è¡Œè¿‡æ»¤
public void onChat(ChatEvent event) {
    // æ•æ„Ÿè¯æ£€æµ‹
    if (containsSensitiveWord(event.getContent())) {
        event.cancel();  // å–æ¶ˆäº‹ä»¶
        return;
    }
    
    // æ›¿æ¢æ•æ„Ÿè¯
    String filtered = filterSensitiveWord(event.getContent());
    event.setContent(filtered);
}

@EventListener(priority = 0)  // åæ‰§è¡Œå¹¿æ’­
public void onChatBroadcast(ChatEvent event) {
    // å¦‚æœäº‹ä»¶è¢«å–æ¶ˆï¼Œä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ
    broadcastChat(event);
}
```

### 3. äº‹ä»¶åˆ†ç±»

```java
// ç©å®¶äº‹ä»¶
public class PlayerEvents {
    public static class PlayerLoginEvent extends GameEvent { }
    public static class PlayerLogoutEvent extends GameEvent { }
    public static class PlayerLevelUpEvent extends GameEvent { }
    public static class PlayerDeathEvent extends GameEvent { }
}

// å…¬ä¼šäº‹ä»¶
public class GuildEvents {
    public static class GuildCreateEvent extends GameEvent { }
    public static class GuildDisbandEvent extends GameEvent { }
    public static class GuildMemberJoinEvent extends GameEvent { }
    public static class GuildMemberLeaveEvent extends GameEvent { }
}

// æˆ˜æ–—äº‹ä»¶
public class BattleEvents {
    public static class BattleStartEvent extends GameEvent { }
    public static class BattleEndEvent extends GameEvent { }
    public static class MonsterKillEvent extends GameEvent { }
}

// ç³»ç»Ÿäº‹ä»¶
public class SystemEvents {
    public static class ServerStartEvent extends GameEvent { }
    public static class ServerShutdownEvent extends GameEvent { }
    public static class ConfigReloadEvent extends GameEvent { }
}
```

---

## æœ€ä½³å®è·µ

### 1. äº‹ä»¶å‘½åè§„èŒƒ

| ç±»å‹ | å‘½åæ ¼å¼ | ç¤ºä¾‹ |
|-----|---------|------|
| ç©å®¶äº‹ä»¶ | Player{Action}Event | PlayerLoginEvent |
| å…¬ä¼šäº‹ä»¶ | Guild{Action}Event | GuildCreateEvent |
| æˆ˜æ–—äº‹ä»¶ | Battle{Action}Event | BattleEndEvent |
| ç³»ç»Ÿäº‹ä»¶ | System{Action}Event | SystemConfigReloadEvent |

### 2. äº‹ä»¶ä½¿ç”¨åœºæ™¯

| åœºæ™¯ | æœ¬åœ°äº‹ä»¶ | åˆ†å¸ƒå¼äº‹ä»¶ |
|-----|---------|-----------|
| å‘æ”¾å¥–åŠ± | âœ“ | |
| æ›´æ–°ä»»åŠ¡ | âœ“ | |
| æ¨é€é€šçŸ¥ | âœ“ | |
| è®°å½•æ—¥å¿— | âœ“ | |
| é…ç½®é‡è½½ | | âœ“ |
| ç¼“å­˜å¤±æ•ˆ | | âœ“ |
| å…¨æœå…¬å‘Š | | âœ“ |
| è·¨æœé€šçŸ¥ | | âœ“ |

### 3. å¼‚æ­¥äº‹ä»¶å¤„ç†

```java
// è€—æ—¶æ“ä½œä½¿ç”¨å¼‚æ­¥
@EventListener(async = true)
public void onPlayerLogin(PlayerLoginEvent event) {
    // å¼‚æ­¥å¤„ç†ï¼š
    // - å‘é€é‚®ä»¶
    // - è®°å½•æ—¥å¿—
    // - ç»Ÿè®¡åˆ†æ
}

// å¿«é€Ÿå“åº”ä½¿ç”¨åŒæ­¥
@EventListener
public void onPlayerDeath(PlayerDeathEvent event) {
    // åŒæ­¥å¤„ç†ï¼š
    // - æ‰£é™¤æƒ©ç½š
    // - å¤æ´»é€»è¾‘
}
```

### 4. äº‹ä»¶ç›‘å¬é¡ºåº

```java
// ä¼˜å…ˆçº§é«˜çš„å…ˆæ‰§è¡Œ
@EventListener(priority = 100)  // ç¬¬1æ‰§è¡Œï¼šè¿‡æ»¤æ£€æŸ¥
public void filter(ChatEvent event) { }

@EventListener(priority = 50)   // ç¬¬2æ‰§è¡Œï¼šæ—¥å¿—è®°å½•
public void log(ChatEvent event) { }

@EventListener(priority = 0)    // ç¬¬3æ‰§è¡Œï¼šå¹¿æ’­æ¶ˆæ¯
public void broadcast(ChatEvent event) { }
```

### 5. é¿å…å¾ªç¯äº‹ä»¶

```java
// é”™è¯¯ç¤ºä¾‹ï¼šå¯èƒ½å¯¼è‡´æ— é™å¾ªç¯
@EventListener
public void onLevelUp(PlayerLevelUpEvent event) {
    // å‘æ”¾å¥–åŠ±
    addExp(event.getRoleId(), 100);  // å¯èƒ½å†æ¬¡è§¦å‘å‡çº§äº‹ä»¶
}

// æ­£ç¡®åšæ³•ï¼šæ ‡è®°æ¥æº
@Getter
public class PlayerLevelUpEvent extends GameEvent {
    private final boolean fromReward;  // æ ‡è®°æ˜¯å¦æ¥è‡ªå¥–åŠ±
    // ...
}

@EventListener
public void onLevelUp(PlayerLevelUpEvent event) {
    if (event.isFromReward()) {
        return;  // æ¥è‡ªå¥–åŠ±çš„å‡çº§ä¸å†å‘å¥–åŠ±
    }
    addExp(event.getRoleId(), 100);
}
```

---

## å¸¸è§é—®é¢˜

### Q1: æœ¬åœ°äº‹ä»¶ vs åˆ†å¸ƒå¼äº‹ä»¶ï¼Ÿ

| ç‰¹æ€§ | æœ¬åœ°äº‹ä»¶ | åˆ†å¸ƒå¼äº‹ä»¶ |
|-----|---------|-----------|
| èŒƒå›´ | å•æœåŠ¡å†… | è·¨æœåŠ¡ |
| æ€§èƒ½ | é«˜ | è¾ƒä½ |
| å¯é æ€§ | é«˜ | ä¾èµ–ä¸­é—´ä»¶ |
| é¡ºåºä¿è¯ | æœ‰ | æ—  |

### Q2: äº‹ä»¶ç›‘å¬å™¨å¼‚å¸¸æ€ä¹ˆåŠï¼Ÿ

```java
// æ¡†æ¶ä¼šæ•è·å¼‚å¸¸å¹¶è®°å½•æ—¥å¿—
// å•ä¸ªç›‘å¬å™¨å¼‚å¸¸ä¸å½±å“å…¶ä»–ç›‘å¬å™¨
@EventListener
public void onEvent(SomeEvent event) {
    try {
        // ä¸šåŠ¡é€»è¾‘
    } catch (Exception e) {
        log.error("å¤„ç†äº‹ä»¶å¼‚å¸¸", e);
        // å¯ä»¥é€‰æ‹©é‡æ–°æŠ›å‡ºæˆ–å¿½ç•¥
    }
}
```

### Q3: å¦‚ä½•è°ƒè¯•äº‹ä»¶æµï¼Ÿ

```java
// åœ¨ logback.xml ä¸­å¼€å¯ debug æ—¥å¿—
<logger name="com.game.core.event" level="DEBUG" />

// æ—¥å¿—è¾“å‡ºç¤ºä¾‹ï¼š
// æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨: event=PlayerLevelUpEvent, listener=GameEventListener.onLevelUp
// å‘å¸ƒäº‹ä»¶: PLAYER_LEVEL_UP
// äº‹ä»¶å¤„ç†è€—æ—¶: event=PLAYER_LEVEL_UP, cost=5ms
```
